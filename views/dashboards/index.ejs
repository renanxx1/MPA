<%- include ('../partials/header.ejs')%>
    <link rel="stylesheet" href="/assets/vendors/iconfonts/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="/assets/css/shared/style.css">
    <link rel="stylesheet" href="/assets/css/demo_1/style.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />

    <%- include ('../partials/navbar.ejs')%>

        <div id="layoutSidenav_content">
            <main>
                <div id="container-fluid" class="container-fluid">

                    <h1 class="mt-3 display-6">Dashboard Geral</h1>

                    <div class="row page-title-header">
                        <div class="page-header mb-1 mt-0">
                        </div>

                        <div class="col-md-12 text-center">
                            <div class="page-header-toolbar">


                                <input id="anythingSearch" type="search" id="form1"
                                    class=" ml-auto form-control  input-group-sm" placeholder="Procurar..."
                                    style="width: 20%; height:29px" />

                                <button type="button" class="ml-1 btn btn-dark">
                                    Filtros <i class="fas fa-search"></i>
                                </button>

                            </div>
                        </div>
                    </div>

                    <div id="myDIV" class="row">
                        <%if(collaborators==null){ %>
                            <h1>Sem colaboradores cadastrados no sistema.</h1>
                            <%}%>
                                <%collaborators.forEach(collaborator=> { %>


                                    <div class="col-xl-4" style="display: flex;">
                                        <div class="card mb-4">

                                            <div class="card-body"
                                                onclick="redirect('<%=collaborator.process.process_name%>', '<%=collaborator.id%>')">

                                                <h6 id="collaboratorLogged_<%=collaborator.id%>" class="float-right"
                                                    style="color: red">offline</h6>
                                                <img class="img-fluid float-right" width="13%"
                                                    src="../../assets/img/prod.png"
                                                    style="margin-top: 6%; margin-right:-12.5%">


                                                <h6 id="collaborator" value="<%=collaborator.collaborator_name%>"
                                                    class="mr-auto  ml-2 display-5">Colaborador:
                                                    <b>
                                                        <%=collaborator.collaborator_name%>
                                                    </b>
                                                </h6>


                                                <h6 id="process" value="<%=collaborator.process.process_name%>"
                                                    class="mr-auto ml-2 display-5">Processo:
                                                    <b>
                                                        <%=collaborator.process.process_name%>
                                                    </b>
                                                </h6>

                                                <h6 class="mr-auto  ml-2 display-5">Status:
                                                    <% if(collaborator.status==true){%>
                                                        <b> Ativo</b>
                                                        <%}else{%>
                                                            <b> Desativado</b>
                                                            <%}%>
                                                </h6>
                                            </div>
                                            <div class="card-footer text-center">
                                                <h5 id="collaboratorExec_<%=collaborator.id%>"
                                                    class="text-center display-5">
                                                    <b>
                                                         
                                                    </b>
                                                </h5>

                                            </div>
                                        </div>
                                    </div>
                                    <%})%>
                    </div>
            </main>
            <%- include ('../partials/footer.ejs')%>
        </div>

        </html>

        <script src="/js/socket.io.js"></script>

        <script>
            //Conexao com socket io
            var url_atual = window.location.href.split('/');
            var url = url_atual[2];
            var socket = io('192.168.1.67');
            console.log(url)
        </script>


        <script>
            $(document).ready(function () {
                $("#anythingSearch").on("keyup", function () {
                    var value = $(this).val().toLowerCase();
                    $(".col-xl-4").filter(function () {
                        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                    });
                });
            });

            document.getElementById("anythingSearch").addEventListener("search", function (event) {
                var value = $(this).val().toLowerCase();
                $(".col-xl-4").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });


            $('.card-body').hover(function () {
                $(this).css('cursor', 'pointer');
            });

            function redirect(process, id) {
                window.location.href = "/dashboard/" + process + '/' + id;
            }
        </script>


        <script>
            socket.on("newDataAvailable", (data) => {

                $('#collaboratorLogged_' + data.collaborator_id).html('online');
                $('#collaboratorLogged_' + data.collaborator_id).css('color', 'rgb(14, 202, 14)');
                $('#collaboratorExec_' + data.collaborator_id).html(data.activity_name);
                console.log(newDataChart)
            })

            socket.on('collaboratorOff', (data) => {
                $('#collaboratorLogged_' + data.collaborator_id).html('offline');
                $('#collaboratorLogged_' + data.collaborator_id).css('color', 'red');
                $('#collaboratorExec_' + data.collaborator_id).html(' ');
            })

        </script>